{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.setAppState = setAppState;\nexports.snapshot = snapshot;\nexports.saveInitialSnapshot = saveInitialSnapshot;\nexports.filterSnapshots = filterSnapshots;\n\nvar _functions = require('../functions');\n\nvar fn = _interopRequireWildcard(_functions);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj['default'] = obj;\n    return newObj;\n  }\n}\n\nfunction setAppState(instance, data, onStore) {\n  var obj = instance.deserialize(data);\n  fn.eachObject(function (key, value) {\n    var store = instance.stores[key];\n\n    if (store) {\n      (function () {\n        var config = store.StoreModel.config;\n        var state = store.state;\n        if (config.onDeserialize) obj[key] = config.onDeserialize(value) || value;\n\n        if (fn.isMutableObject(state)) {\n          fn.eachObject(function (k) {\n            return delete state[k];\n          }, [state]);\n          fn.assign(state, obj[key]);\n        } else {\n          store.state = obj[key];\n        }\n\n        onStore(store, store.state);\n      })();\n    }\n  }, [obj]);\n}\n\nfunction snapshot(instance) {\n  var storeNames = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n  var stores = storeNames.length ? storeNames : Object.keys(instance.stores);\n  return stores.reduce(function (obj, storeHandle) {\n    var storeName = storeHandle.displayName || storeHandle;\n    var store = instance.stores[storeName];\n    var config = store.StoreModel.config;\n    store.lifecycle('snapshot');\n    var customSnapshot = config.onSerialize && config.onSerialize(store.state);\n    obj[storeName] = customSnapshot ? customSnapshot : store.getState();\n    return obj;\n  }, {});\n}\n\nfunction saveInitialSnapshot(instance, key) {\n  var state = instance.deserialize(instance.serialize(instance.stores[key].state));\n  instance._initSnapshot[key] = state;\n  instance._lastSnapshot[key] = state;\n}\n\nfunction filterSnapshots(instance, state, stores) {\n  return stores.reduce(function (obj, store) {\n    var storeName = store.displayName || store;\n\n    if (!state[storeName]) {\n      throw new ReferenceError(String(storeName) + ' is not a valid store');\n    }\n\n    obj[storeName] = state[storeName];\n    return obj;\n  }, {});\n}","map":{"version":3,"sources":["D:/Projects/W_e_e_b/my-app/node_modules/alt/lib/utils/StateFunctions.js"],"names":["Object","defineProperty","exports","value","setAppState","snapshot","saveInitialSnapshot","filterSnapshots","_functions","require","fn","_interopRequireWildcard","obj","__esModule","newObj","key","prototype","hasOwnProperty","call","instance","data","onStore","deserialize","eachObject","store","stores","config","StoreModel","state","onDeserialize","isMutableObject","k","assign","storeNames","arguments","length","undefined","keys","reduce","storeHandle","storeName","displayName","lifecycle","customSnapshot","onSerialize","getState","serialize","_initSnapshot","_lastSnapshot","ReferenceError","String"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.setAppState = setAppState;\nexports.snapshot = snapshot;\nexports.saveInitialSnapshot = saveInitialSnapshot;\nexports.filterSnapshots = filterSnapshots;\n\nvar _functions = require('../functions');\n\nvar fn = _interopRequireWildcard(_functions);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj['default'] = obj; return newObj; } }\n\nfunction setAppState(instance, data, onStore) {\n  var obj = instance.deserialize(data);\n  fn.eachObject(function (key, value) {\n    var store = instance.stores[key];\n    if (store) {\n      (function () {\n        var config = store.StoreModel.config;\n\n        var state = store.state;\n        if (config.onDeserialize) obj[key] = config.onDeserialize(value) || value;\n        if (fn.isMutableObject(state)) {\n          fn.eachObject(function (k) {\n            return delete state[k];\n          }, [state]);\n          fn.assign(state, obj[key]);\n        } else {\n          store.state = obj[key];\n        }\n        onStore(store, store.state);\n      })();\n    }\n  }, [obj]);\n}\n\nfunction snapshot(instance) {\n  var storeNames = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n  var stores = storeNames.length ? storeNames : Object.keys(instance.stores);\n  return stores.reduce(function (obj, storeHandle) {\n    var storeName = storeHandle.displayName || storeHandle;\n    var store = instance.stores[storeName];\n    var config = store.StoreModel.config;\n\n    store.lifecycle('snapshot');\n    var customSnapshot = config.onSerialize && config.onSerialize(store.state);\n    obj[storeName] = customSnapshot ? customSnapshot : store.getState();\n    return obj;\n  }, {});\n}\n\nfunction saveInitialSnapshot(instance, key) {\n  var state = instance.deserialize(instance.serialize(instance.stores[key].state));\n  instance._initSnapshot[key] = state;\n  instance._lastSnapshot[key] = state;\n}\n\nfunction filterSnapshots(instance, state, stores) {\n  return stores.reduce(function (obj, store) {\n    var storeName = store.displayName || store;\n    if (!state[storeName]) {\n      throw new ReferenceError(String(storeName) + ' is not a valid store');\n    }\n    obj[storeName] = state[storeName];\n    return obj;\n  }, {});\n}"]},"metadata":{},"sourceType":"script"}